{"name": "test_charge[case9]", "status": "failed", "statusDetails": {"message": "AssertionError: assert '金额必须大于0并且小于或者等于500000' == '余额必须大于0并且小于或者等于500000'\n  - 余额必须大于0并且小于或者等于500000\n  ? ^\n  + 金额必须大于0并且小于或者等于500000\n  ? ^", "trace": "self = <test_case.test_charge.TestChargeCase object at 0x000001B58036F580>\ncase = {'data': {'amount': -600, 'member_id': '14'}, 'expected': {'code': 2, 'msg': '金额必须大于0并且小于或者等于500000'}, 'interface': 'recharge', 'method': 'POST', ...}\nset_Up = ('14', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJtZW1iZXJfaWQiOjE0LCJleHAiOjE1OTIxMjA1MTJ9.ezsFimCoaQ0rr_3Q6NwaGJgg8g5m0jkIIczcp-ByY9F4nLzVXGNH91aj8Mmo2j0dWFXIvsxe9VdpWK2sBevM6g')\n\n    @pytest.mark.parametrize(\"case\",cases)\n    def test_charge(self, case,set_Up):\n        member_id,token = set_Up\n        # 接口测试需要准备的测试数据 采用拼接的方式，取配置文件中的baseurl + excel中的\n        url = conf.get(\"env\", \"url\") + case[\"url\"]\n        # method\n        print(url)\n        method = case[\"method\"]\n        # data 需要传入用户的id ，excel 中使用 #member_id# 进行站位，需要进行替换\n        # print(case[\"data\"])\n        data = case[\"data\"]\n        if \"#member_id#\" in data.values():\n            data[\"member_id\"] = member_id\n        print(data)\n        # 定义请求头信息\n        headers = eval(conf.get(\"env\", \"headers\"))\n        # headers 从配置文件取出来是一个字典类型\n        headers[\"Authorization\"] = token\n        expected = case[\"expected\"]\n        # 判断用例是否需要db校验，获取充值之前的账户余额是否\n        # 调用requests库发送请求，\n        if \"check_sql\" in case.keys():\n            sql = case[\"check_sql\"].format(member_id)\n            # 获得充值之前的money量\n            # 返回数据类型为dict 因为之前采用了dict游标\n            # 所以可以直接进行取值 leave amount 为可用余额\n            s_money = self.db.find_one(sql)[\"leave_amount\"]\n            print(F\"充值之前的金额为：{s_money}\")\n    \n        # 第二部： 发送请求获取实际结果\n        response = request(url=url, method=method, json=data,\n                           headers=headers)\n        result = response.json()\n        print(F\"预期结果：{expected}\")\n        print(F\"实际结果：{result}\")\n        # 取得返回结果进行断言用例是否通过\n        # 断言预期结果和实际结果\n        ## 判断该用例是否需要db校验，获取充值后的账户余额\n        if \"check_sql\" in case.keys():\n            sql = case[\"check_sql\"].format(member_id)\n            end_money = self.db.find_one(sql)[\"leave_amount\"]\n            print(F\"充值之后的金额{end_money}\")\n        try:\n            assert expected['code'] == result['code']\n            assert expected['msg'] == result['msg']\n    \n            # 还要判断是否进行sql校验DB\n            if \"check_sql\" in case.keys():\n                # 将充值金额转换成decimal类型 db中的类型\n                charge_money = decimal.Decimal(str(data[\"amount\"]))\n                assert charge_money == end_money -s_money\n        except AssertionError as e:\n            # 结果回写excel\n            log.error(\"用例--{}--执行未通过\".format(case[\"title\"]))\n            log.debug(\"预期结果：{}\".format(expected))\n            log.debug(\"实际结果：{}\".format(result))\n            log.exception(e)\n>           raise e\n\ntest_case\\test_charge.py:192: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <test_case.test_charge.TestChargeCase object at 0x000001B58036F580>\ncase = {'data': {'amount': -600, 'member_id': '14'}, 'expected': {'code': 2, 'msg': '金额必须大于0并且小于或者等于500000'}, 'interface': 'recharge', 'method': 'POST', ...}\nset_Up = ('14', 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJtZW1iZXJfaWQiOjE0LCJleHAiOjE1OTIxMjA1MTJ9.ezsFimCoaQ0rr_3Q6NwaGJgg8g5m0jkIIczcp-ByY9F4nLzVXGNH91aj8Mmo2j0dWFXIvsxe9VdpWK2sBevM6g')\n\n    @pytest.mark.parametrize(\"case\",cases)\n    def test_charge(self, case,set_Up):\n        member_id,token = set_Up\n        # 接口测试需要准备的测试数据 采用拼接的方式，取配置文件中的baseurl + excel中的\n        url = conf.get(\"env\", \"url\") + case[\"url\"]\n        # method\n        print(url)\n        method = case[\"method\"]\n        # data 需要传入用户的id ，excel 中使用 #member_id# 进行站位，需要进行替换\n        # print(case[\"data\"])\n        data = case[\"data\"]\n        if \"#member_id#\" in data.values():\n            data[\"member_id\"] = member_id\n        print(data)\n        # 定义请求头信息\n        headers = eval(conf.get(\"env\", \"headers\"))\n        # headers 从配置文件取出来是一个字典类型\n        headers[\"Authorization\"] = token\n        expected = case[\"expected\"]\n        # 判断用例是否需要db校验，获取充值之前的账户余额是否\n        # 调用requests库发送请求，\n        if \"check_sql\" in case.keys():\n            sql = case[\"check_sql\"].format(member_id)\n            # 获得充值之前的money量\n            # 返回数据类型为dict 因为之前采用了dict游标\n            # 所以可以直接进行取值 leave amount 为可用余额\n            s_money = self.db.find_one(sql)[\"leave_amount\"]\n            print(F\"充值之前的金额为：{s_money}\")\n    \n        # 第二部： 发送请求获取实际结果\n        response = request(url=url, method=method, json=data,\n                           headers=headers)\n        result = response.json()\n        print(F\"预期结果：{expected}\")\n        print(F\"实际结果：{result}\")\n        # 取得返回结果进行断言用例是否通过\n        # 断言预期结果和实际结果\n        ## 判断该用例是否需要db校验，获取充值后的账户余额\n        if \"check_sql\" in case.keys():\n            sql = case[\"check_sql\"].format(member_id)\n            end_money = self.db.find_one(sql)[\"leave_amount\"]\n            print(F\"充值之后的金额{end_money}\")\n        try:\n            assert expected['code'] == result['code']\n>           assert expected['msg'] == result['msg']\nE           AssertionError: assert '金额必须大于0并且小于或者等于500000' == '余额必须大于0并且小于或者等于500000'\nE             - 余额必须大于0并且小于或者等于500000\nE             ? ^\nE             + 金额必须大于0并且小于或者等于500000\nE             ? ^\n\ntest_case\\test_charge.py:179: AssertionError"}, "attachments": [{"name": "log", "source": "d93153e8-4ff5-4279-ac9b-e0eca7f14293-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "53010235-a011-44ab-becb-b28e08803bd6-attachment.txt", "type": "text/plain"}, {"name": "stderr", "source": "4b2d49f4-c0e3-4d0e-8c4e-e6580ce26037-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "case", "value": "{'interface': 'recharge', 'title': '充值金额为负数', 'method': 'POST', 'url': '/member/recharge', 'data': {'member_id': '#member_id#', 'amount': -600}, 'expected': {'code': 2, 'msg': '金额必须大于0并且小于或者等于500000'}}"}], "start": 1592120213679, "stop": 1592120214725, "uuid": "e862f5d9-0615-409d-800a-f5a2aca24dc7", "historyId": "d1b6fbbe3f1e3d74c875eda8ce035e90", "testCaseId": "75329c55a5a1b5c7d66ace80f05e893e", "fullName": "test_case.test_charge.TestChargeCase#test_charge", "labels": [{"name": "parentSuite", "value": "test_case"}, {"name": "suite", "value": "test_charge"}, {"name": "subSuite", "value": "TestChargeCase"}, {"name": "host", "value": "DESKTOP-JCG0M2F"}, {"name": "thread", "value": "24708-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_case.test_charge"}]}